services:
  perforce:
    build: frozenfoxx/p4d:latest
    container_name: p4d
    restart: unless-stopped
    ulimits:
      nofile:
        soft: 65535
        hard: 65535
    ports:
      - "1666:1666"
    environment:
      - FQDN="perforce.local"
      - P4ROOT=/opt/perforce/server
      - P4_DEPOTS=/opt/perforce/depots
      # - P4SSLDIR=/opt/perforce/ssl
      # - SSL_ENABLED=true
      # - UID=1000
      # - GID=1000
    volumes:
      - ./server:/opt/perforce/server
      # - ./ssl:/opt/perforce/ssl
      - ./depots:/opt/perforce/depots
    healthcheck:
      test: ["CMD", "/usr/sbin/p4", "-p", "1666", "info"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s